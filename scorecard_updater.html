<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Cricket Scorecard Updater</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #141E30;
      color: white;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 20px;
      padding: 20px;
    }
    .updater, .name-input {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      justify-content: center;
    }
    button, input {
      padding: 10px;
      margin: 5px;
      background-color: #00bfff;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    button:hover, input:hover {
      background-color: #007bbf;
    }
    input {
      width: 150px;
      color: black;
    }
    .scorecard {
      background: #243B55;
      padding: 15px;
      border-radius: 10px;
      margin: 10px;
      text-align: center;
      width: 300px;
    }
  </style>
</head>
<body>
  <h1>Cricket Scorecard Updater</h1>

  <!-- Name Updater -->
  <div class="name-input">
    <input type="text" id="batter1Name" placeholder="Batter 1 Name">
    <input type="text" id="batter2Name" placeholder="Batter 2 Name">
    <button onclick="updateNames()">Update Names</button>
    <button onclick="clearScorecard()">Clear Scorecard</button>
  </div>

  <!-- Scorecard Display -->
  <div class="scorecard">
    <p id="score">Score: 0-0</p>
    <p id="overs">Overs: 0.0</p>
    <p id="striker">Striker: Batter 1 (0 runs, 0 balls)</p>
    <p id="nonStriker">Non-Striker: Batter 2 (0 runs, 0 balls)</p>
  </div>

  <!-- Scoring Buttons -->
  <div class="updater">
    <button onclick="updateScore(1)">1 Run</button>
    <button onclick="updateScore(2)">2 Runs</button>
    <button onclick="updateScore(3)">3 Runs</button>
    <button onclick="updateScore(4)">4 Runs</button>
    <button onclick="updateScore(6)">6 Runs</button>
    <button onclick="noBall()">No Ball</button>
    <button onclick="wideBall()">Wide Ball</button>
    <button onclick="wicket()">Wicket</button>
    <button onclick="undoLastAction()">Undo</button>
  </div>

  <script>
    let scoreData = JSON.parse(localStorage.getItem('scoreData')) || {
      runs: 0, wickets: 0, balls: 0, overs: 0.0,
      batter1Score: 0, batter2Score: 0, batter1Balls: 0, batter2Balls: 0,
      striker: 'batter1', nonStriker: 'batter2',
      batter1: 'Batter 1', batter2: 'Batter 2',
      history: []
    };

    function saveHistory() {
      const snapshot = JSON.parse(JSON.stringify(scoreData));
      scoreData.history.push(snapshot);
      if (scoreData.history.length > 50) scoreData.history.shift();
    }

    function updateNames() {
      scoreData.batter1 = document.getElementById("batter1Name").value || 'Batter 1';
      scoreData.batter2 = document.getElementById("batter2Name").value || 'Batter 2';
      saveData();
    }

    function updateScore(run) {
      saveHistory();
      scoreData.runs += run;
      scoreData.balls++;

      if (scoreData.striker === "batter1") {
        scoreData.batter1Score += run;
        scoreData.batter1Balls++;
      } else {
        scoreData.batter2Score += run;
        scoreData.batter2Balls++;
      }

      if (run % 2 !== 0) {
        [scoreData.striker, scoreData.nonStriker] = [scoreData.nonStriker, scoreData.striker];
      }

      if (scoreData.balls === 6) {
        scoreData.balls = 0;
        scoreData.overs = (parseInt(scoreData.overs) + 1) + 0.0;
        [scoreData.striker, scoreData.nonStriker] = [scoreData.nonStriker, scoreData.striker];
      } else {
        scoreData.overs = parseInt(scoreData.overs) + Math.floor(scoreData.balls) / 10;
      }

      saveData();
    }

    function noBall() {
      saveHistory();
      const extraRuns = parseInt(prompt("Enter runs scored on No Ball (excluding extra):", "0")) || 0;
      scoreData.runs += 1 + extraRuns;

      if (scoreData.striker === "batter1") {
        scoreData.batter1Score += extraRuns;
        scoreData.batter1Balls++;
      } else {
        scoreData.batter2Score += extraRuns;
        scoreData.batter2Balls++;
      }

      if (extraRuns % 2 !== 0) {
        [scoreData.striker, scoreData.nonStriker] = [scoreData.nonStriker, scoreData.striker];
      }

      saveData();
    }

    function wideBall() {
      saveHistory();
      const extraRuns = parseInt(prompt("Enter runs scored on Wide Ball:", "0")) || 0;
      scoreData.runs += 1 + extraRuns;
      saveData();
    }

    function wicket() {
      saveHistory();
      scoreData.wickets++;
      scoreData.balls++;

      if (scoreData.balls === 6) {
        scoreData.balls = 0;
        scoreData.overs = (parseInt(scoreData.overs) + 1) + 0.0;
        [scoreData.striker, scoreData.nonStriker] = [scoreData.nonStriker, scoreData.striker];
      } else {
        scoreData.overs = parseInt(scoreData.overs) + Math.floor(scoreData.balls) / 10;
      }

      saveData();
    }

    function undoLastAction() {
      if (scoreData.history && scoreData.history.length > 0) {
        const lastState = scoreData.history.pop();
        Object.assign(scoreData, lastState);
        saveData();
        updateDisplay();
      } else {
        alert("No actions to undo.");
      }
    }

    function clearScorecard() {
      localStorage.removeItem('scoreData');
      location.reload();
    }

    function saveData() {
      localStorage.setItem('scoreData', JSON.stringify(scoreData));
      updateBackend();
      updateDisplay();
    }

    function updateBackend() {
      fetch('/api/score', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(scoreData)
      });
    }

    function updateDisplay() {
      document.getElementById('score').textContent = `Score: ${scoreData.runs}-${scoreData.wickets}`;
      document.getElementById('overs').textContent = `Overs: ${scoreData.overs.toFixed(1)}`;
      document.getElementById('striker').textContent =
        `Striker: ${scoreData[scoreData.striker]} (${scoreData.striker === 'batter1' ? scoreData.batter1Score : scoreData.batter2Score} runs, ${scoreData.striker === 'batter1' ? scoreData.batter1Balls : scoreData.batter2Balls} balls)`;
      document.getElementById('nonStriker').textContent =
        `Non-Striker: ${scoreData[scoreData.nonStriker]} (${scoreData.nonStriker === 'batter1' ? scoreData.batter1Score : scoreData.batter2Score} runs, ${scoreData.nonStriker === 'batter1' ? scoreData.batter1Balls : scoreData.batter2Balls} balls)`;
    }

    updateDisplay();
  </script>
</body>
</html>
